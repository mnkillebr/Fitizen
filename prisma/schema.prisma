// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(cuid())
  email             String             @unique
  passwordHash      String?
  name              String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  socialLogins      SocialLogin[]
  userSubscriptions UserSubscription[]
  workoutLogs       WorkoutLog[]
  leaderboardScores Leaderboard[]
}

model SocialLogin {
  id             String    @id @default(cuid())
  provider       String
  providerUserId String
  user           User   @relation(fields: [userId], references: [id])
  userId         String

  @@unique([provider, providerUserId])
}

model Subscription {
  id                String             @id @default(cuid())
  name              String
  price             Decimal
  description       String?
  userSubscriptions UserSubscription[]
}

model UserSubscription {
  id             String          @id @default(cuid())
  user           User         @relation(fields: [userId], references: [id])
  userId         String
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])
  subscriptionId String
  startDate      DateTime
  endDate        DateTime?
}

model Program {
  id          String              @id @default(cuid())
  name        String
  description String?
  isFree      Boolean          @default(false)
  price       Decimal?

  youtubeLink   String?
  s3ImageKey    String?
  s3VideoKey    String?

  routines    ProgramRoutine[]
}

model Routine {
  id            String             @id @default(cuid())
  name          String
  description   String?
  isFree        Boolean            @default(false)

  youtubeLink   String?
  s3ImageKey    String?
  s3VideoKey    String?

  programs      ProgramRoutine[]
  exercises     RoutineExercise[]
  workoutLogs   WorkoutLog[]
  leaderboard   Leaderboard[]

  createdAt     DateTime           @default(now())
}

model ProgramRoutine {
  program   Program @relation(fields: [programId], references: [id])
  programId String
  routine   Routine @relation(fields: [routineId], references: [id])
  routineId String

  @@id([programId, routineId])
}

model Exercise {
  id            String               @id @default(cuid())
  name          String
  description   String?
  isFree        Boolean           @default(false)
  routines      RoutineExercise[]
  exerciseLogs  ExerciseLog[]
  cues          String[]
  tips          String[]

  youtubeLink   String?
  s3ImageKey    String?
  s3VideoKey    String?
  tags          String[]

  balance       BalanceType?
  balanceLevel  BalanceLevel?
  body          BodyFocus[]
  contraction   ContractionType?
  equipment     Equipment[]
  joint         Joint[]
  lift          LiftType?
  muscles       MuscleGroup[]
  pattern       MovementPattern[]
  plane         MovementPlane[]
  stretch       StretchType?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model RoutineExercise {
  routine        Routine @relation(fields: [routineId], references: [id])
  routineId      String
  exercise       Exercise @relation(fields: [exerciseId], references: [id])
  exerciseId     String
  orderInRoutine Int
  section        SectionType?

  @@id([routineId, exerciseId])
}

model WorkoutLog {
  id          String           @id @default(cuid())
  user        User          @relation(fields: [userId], references: [id])
  userId      String
  routine     Routine       @relation(fields: [routineId], references: [id])
  routineId   String
  date        DateTime      @default(now())
  exerciseLogs ExerciseLog[]
}

model ExerciseLog {
  id           String        @id @default(cuid())
  workoutLog   WorkoutLog @relation(fields: [workoutLogId], references: [id])
  workoutLogId String
  exercise     Exercise   @relation(fields: [exerciseId], references: [id])
  exerciseId   String
  sets         Int?
  reps         Int?
  weight       Decimal?
  unit         LoadUnit   @default(pound)
  duration     Int?        // Duration in seconds
}

model Leaderboard {
  id       Int      @id @default(autoincrement())
  user     User     @relation(fields: [userId], references: [id])
  userId   String
  routine  Routine  @relation(fields: [routineId], references: [id])
  routineId String
  score    Int
  date     DateTime @default(now())
}

// Enums for Exercise Properties
enum BalanceType {
  bilateral
  unilateral
}

enum BalanceLevel {
  static
  dynamic
}

enum BodyFocus {
  upper
  lower
  core
  full
}

enum ContractionType {
  isometric
  isotonic
}

enum Equipment {
  bodyweight
  dumbbell
  kettlebell
  barbell
  resistance_band
  suspension
  parallette
  slider_discs
  gymnastics_rings
}

enum Joint {
  ankle
  knee
  hip
  shoulder
  elbow
  wrist
}

enum LiftType {
  compound
  isolation
}

enum LoadUnit {
  kilogram
  pound
}

enum MuscleGroup {
  quads
  hamstrings
  glutes
  calves
  shoulders
  biceps
  triceps
  forearms
  pecs
  lats
  traps
  hip_flexors
  erectors
  adductors
  abductors
  abs
  obliques
  serratus
  pelvic_floor
}

enum MovementPattern {
  push
  pull
  core
  squat
  hinge
  lunge
  rotational
  locomotive
}

enum MovementPlane {
  frontal
  sagittal
  transverse
}

enum StretchType {
  static
  dynamic
}

enum SectionType {
  warmup
  main
  cooldown
}
